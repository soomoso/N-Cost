// Generated by CoffeeScript 2.7.0
(function() {
  //=> Formatting for the Brazilian format
  var TEXT_BASE, calcularValores, formatar, resetar;

  formatar = function(valor) {
    return valor.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  };

  //=> Text-base for Report
  TEXT_BASE = `As a CLT employee, you will receive a net monthly salary of R$ XXXX,XX (excluding benefits) or approximately R$ XXXX,XX when the full benefits package is included.

The total annual gross compensation, already including the 13th salary and vacation pay, will be approximately R$ XX,XXX.XX, equivalent to an hourly rate of R$ XX.XX.

The total annual cost to the company, including all payroll taxes, social charges, and benefits, amounts to R$ XX,XXX.XX.`;

  //=> Full operation
  calcularValores = function() {
    var annualCosts, baseIRRF, benefits, grossSalary, inss, inssPatronal, irrf, monthlyHours, netSalaryHout, netSalaryWith, sAnnual, sCosts, sHour, sHout, sWith, salaryAnnual, text, valorHora, workSchedule;
    grossSalary = parseFloat(document.querySelector('#form-gross-salary').value);
    benefits = parseFloat(document.querySelector('#form-benefits').value);
    workSchedule = parseFloat(document.querySelector('.nc-application__form-select').value);
    if (!((grossSalary != null) && (benefits != null) && (workSchedule != null))) {
      return;
    }
    //=> INSS
    if (grossSalary <= 1518.00) {
      inss = grossSalary * 0.075;
    } else if (grossSalary <= 2793.88) {
      inss = (1518.00 * 0.075) + ((grossSalary - 1518.00) * 0.09);
    } else if (grossSalary <= 4190.83) {
      inss = (1518.00 * 0.075) + ((2793.88 - 1518.00) * 0.09) + ((grossSalary - 2793.88) * 0.12);
    } else if (grossSalary <= 8157.41) {
      inss = (1518.00 * 0.075) + ((2793.88 - 1518.00) * 0.09) + ((4190.83 - 2793.88) * 0.12) + ((grossSalary - 4190.83) * 0.14);
    } else {
      inss = 1140;
    }
    //=> IRRF
    baseIRRF = grossSalary - inss;
    if (baseIRRF < 2259.20) {
      irrf = 0;
    } else if (baseIRRF <= 2826.65) {
      irrf = baseIRRF * 0.075 - 169.44;
    } else if (baseIRRF <= 3751.05) {
      irrf = baseIRRF * 0.15 - 381.44;
    } else if (baseIRRF <= 4664.68) {
      irrf = baseIRRF * 0.225 - 662.77;
    } else {
      irrf = baseIRRF * 0.275 - 896.00;
    }
    //=> Final Calc
    netSalaryHout = baseIRRF - inss - irrf;
    netSalaryWith = grossSalary - inss - irrf + benefits;
    salaryAnnual = (netSalaryWith * 12) + netSalaryWith + (netSalaryWith / 3);
    monthlyHours = workSchedule * 4.333;
    valorHora = netSalaryWith / monthlyHours;
    inssPatronal = grossSalary * 0.20;
    annualCosts = 12 * (grossSalary + benefits + inssPatronal) + grossSalary + (grossSalary / 3);
    //=> Formatting
    sHout = `R$  ${formatar(netSalaryHout)}`;
    sWith = `R$  ${formatar(netSalaryWith)}`;
    sAnnual = `R$  ${formatar(salaryAnnual)}`;
    sHour = `R$ ${formatar(valorHora)}`;
    sCosts = `R$ ${formatar(annualCosts)}`;
    //=> Update Report
    text = `As a CLT employee, you will receive a net monthly salary of <span class='nc-highlight'>${sHout}</span> (excluding benefits) or
approximately <span class='nc-highlight'>${sWith}</span> when the full benefits package is included.<br><br>

The total annual gross compensation, already including the 13th salary and vacation pay, will 
be approximately <span class='nc-highlight'>${sAnnual}</span>, equivalent to an hourly rate of <span class='nc-highlight'>${sHour}</span>.<br><br>

The total annual cost to the company, including all payroll taxes, social charges, and benefits, amounts to <span class='nc-highlight'>${sCosts}</span>.`;
    return document.querySelector('#nc-report-resume').innerHTML = text;
  };

  //=> Reset
  resetar = function() {
    document.querySelector('#form-gross-salary').value = "";
    document.querySelector('#form-benefits').value = "";
    return document.querySelector('#nc-report-resume').innerText = TEXT_BASE;
  };

  //=> Events
  document.querySelector('#calculate-report').addEventListener('click', function(e) {
    e.preventDefault();
    return calcularValores();
  });

  document.querySelector('#reset-report').addEventListener('click', function(e) {
    e.preventDefault();
    return resetar();
  });

}).call(this);
